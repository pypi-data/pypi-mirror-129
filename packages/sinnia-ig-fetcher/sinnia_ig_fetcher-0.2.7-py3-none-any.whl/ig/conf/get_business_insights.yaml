
graph_api:
  # Some of these metrics are only available for 'day' period; refer to
  # https://developers.facebook.com/docs/instagram-api/reference/user/insights
  # Requesting metrics not available to a period results in error
  # email_contacts, phone_call_clicks, text_message_clicks, get_directions_clicks, online_followers
  host:                     'https://graph.facebook.com/v11.0'
  request_basic_daily_path: '/{user_id}/insights?period={period}&metric=impressions,reach,follower_count,profile_views,website_clicks'
  request_basic_path:       '/{user_id}/insights?period={period}&metric=impressions,reach'
  request_audiences_path:   '/{user_id}/insights?period={period}&metric=audience_gender_age,audience_locale,audience_city,audience_country'
  historic_suffix:          '&since={date_from}&until={date_to}' 

  
queries:
  get_users: |  
    SELECT ua.instagram_id, ua.access_token
    FROM UsersAuth ua 
    JOIN UserAuthsInClient uac ON uac.instagram_id = ua.instagram_id
    JOIN Clients c ON uac.client_id = c.id
    WHERE ua.data_access_until > CURRENT_TIMESTAMP()
    AND ua.instagram_id IS NOT NULL 
    AND ua.active = 1 AND uac.active = 1
    AND c.service_level != "DEACTIVATED"
    
  insert_basic: |
    INSERT INTO UserInsights(user_id, end_time, period, fetched_time,
            {metric_name})
    VALUES ({user_id}, '{end_time}', '{period}', '{fetched_time}',
            {metric_value})
    ON DUPLICATE KEY UPDATE
            {metric_name}={metric_value}
            
  insert_audience_gender_age: |
    INSERT INTO UserInsightsAudienceGenderAge (user_id, end_time, period,
            fetched_time, age, gender, value)
    VALUES ('{user_id}', '{end_time}', '{period}',
            '{fetched_time}', '{age}', '{gender}', {metric_value})
    ON DUPLICATE KEY UPDATE
            value={metric_value}
            
  insert_audience_location: |
    INSERT INTO {table_name} (user_id, end_time, period,
            fetched_time, name, value)
    VALUES ('{user_id}', '{end_time}', '{period}',
            '{fetched_time}', '{metric_name}', {metric_value})
    ON DUPLICATE KEY UPDATE
            value={metric_value}



db_config:
  ig:    
    host:    'sinnia-db-2-3.ce4bgmsedant.us-east-1.rds.amazonaws.com'
    db:      'vizgram'
    user:    'vizgram'
    passwd:  'vzig6-hanGR'
    charset: 'utf8mb4' 

  
