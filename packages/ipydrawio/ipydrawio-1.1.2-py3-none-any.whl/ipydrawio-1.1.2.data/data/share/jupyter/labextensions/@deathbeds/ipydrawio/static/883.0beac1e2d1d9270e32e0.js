"use strict";(self.webpackChunk_deathbeds_ipydrawio=self.webpackChunk_deathbeds_ipydrawio||[]).push([[883,568],{317:(e,t,a)=>{a.d(t,{Z:()=>r});var s=a(609),n=a.n(s)()((function(e){return e[1]}));n.push([e.id,'/**\n  Copyright 2021 ipydrawio contributors\n\n  Licensed under the Apache License, Version 2.0 (the "License");\n  you may not use this file except in compliance with the License.\n  You may obtain a copy of the License at\n\n      http://www.apache.org/licenses/LICENSE-2.0\n\n  Unless required by applicable law or agreed to in writing, software\n  distributed under the License is distributed on an "AS IS" BASIS,\n  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n  See the License for the specific language governing permissions and\n  limitations under the License.\n**/\n\n.jp-IPyDiagram .jp-Diagram {\n  position: absolute;\n}\n',""]);const r=n},367:(e,t,a)=>{a.d(t,{p:()=>o,m:()=>l});var s=a(387),n=a(954),r=(a(186),a(97)),i=a(649);class o extends n.DocumentWidget{constructor(e){super(e),this._urlParams={},this.context=e.context,this._manager=e.manager,this.getSettings=e.getSettings,this._onDiagramTitleChanged(),this.context.pathChanged.connect(this._onDiagramTitleChanged,this),this.context.ready.then((async()=>{r.eM&&console.warn("format",this.format),this._onContextReady()})).catch(console.warn)}get urlParams(){return this._urlParams}set urlParams(e){this._urlParams=e,this.content.maybeReloadFrame()}_onContextReady(){this.context.model.contentChanged.connect(this.content.onContentChanged,this.content),this.content.onContentChanged(),this.content.onAfterShow()}_onDiagramTitleChanged(){r.eM&&console.warn("contentsModel",this.context.contentsModel),this.title.label=s.PathExt.basename(this.context.localPath)}get format(){return null==this.context.contentsModel?null:this._manager.formatForModel(this.context.contentsModel)||null}updateSettings(){this.content.maybeReloadFrame(!0)}}class l extends n.ABCWidgetFactory{constructor(e){super(e),this.getSettings=e.getSettings,this.manager=e.manager}createNewWidget(e){const t=new o({context:e,content:new i.S({adapter:{format:()=>t.format,urlParams:()=>{var e;const a=null===(e=this.getSettings())||void 0===e?void 0:e.drawioUrlParams;return Object.assign(Object.assign({},a),t.urlParams)},drawioConfig:()=>{var e;return null===(e=this.getSettings())||void 0===e?void 0:e.drawioConfig},saveNeedsExport:()=>{var e;const a=null===(e=t.format)||void 0===e?void 0:e.isTransformed;return r.eM&&console.warn("needs export",a),null==a||a},toXML:()=>{const{model:e}=t.context,{format:a}=t;return(null==a?void 0:a.toXML)?a.toXML(e):e.toString()},drawioUrl:()=>this.manager.drawioURL,fromXML:(e,a)=>{const{format:s}=t;(null==s?void 0:s.fromXML)?s.fromXML(t.context.model,e):t.context.model.fromString(e),a&&t.context.save().catch(console.warn)}}}),getSettings:this.getSettings,manager:this.manager});return t.content.escaped.connect((()=>{this.manager.escapeCurrent(t)})),t}create(e){return this.createNewWidget(e)}}},568:(e,t,a)=>{a.r(t),a.d(t,{DiagramDocument:()=>s.p,DiagramFactory:()=>s.m,Diagram:()=>n.S,ALL_BINARY_FORMATS:()=>r.W6,ALL_FORMATS:()=>r.t6,ALL_MIME_FORMATS:()=>r.WY,ALL_TEXT_FORMATS:()=>r.WB,PNG_EDITABLE:()=>r.GS,PNG_PLAIN:()=>r.QL,SVG_EDITABLE:()=>r.R3,SVG_PLAIN:()=>r.nm,XML_LEGACY:()=>r.Fn,XML_NATIVE:()=>r.Fl,drawioIcon:()=>r.EH,drawioPlainIcon:()=>r.Wy,drawioPngIcon:()=>r.TI,drawioSvgIcon:()=>r.Hx,drawioThemeIcons:()=>r.sc,BINARY_FACTORY:()=>i.mD,CMD_NS:()=>i.sr,CommandIds:()=>i.OF,DEBUG:()=>i.eM,DIAGRAM_MENU_RANK:()=>i.pj,DRAWIO_ICON_CLASS_RE:()=>i.zw,DRAWIO_ICON_SVG:()=>i.zY,IDiagramManager:()=>i.rY,IPYDRAWIO_METADATA:()=>i.tm,JSON_FACTORY:()=>i.Yg,MX_APP_MODEL_EVENTS:()=>i.GE,MX_EDITOR_EVENTS:()=>i.lq,MX_GRAPH_EVENTS:()=>i.wO,MX_GRAPH_MODEL_EVENTS:()=>i.qp,MX_GRAPH_PAN_EVENTS:()=>i.Fy,MX_GRAPH_SELECT_EVENTS:()=>i.up,MX_GRAPH_SELECT_MODEL_EVENTS:()=>i.gZ,MX_GRAPH_VIEW_EVENTS:()=>i.Bx,NS:()=>i.NS,PACKAGE:()=>i.iR,PLUGIN_ID:()=>i.Uu,TEXT_FACTORY:()=>i.fO,UI_THEMES:()=>i.oP,UI_THEME_BASE_COLOR:()=>i.Ht,UI_THEME_COLORS:()=>i.cr,VERSION:()=>i.q4,DiagramModel:()=>o.DiagramModel,DiagramView:()=>o.DiagramView,XMLModel:()=>o.XMLModel,XMLView:()=>o.XMLView,stripDataURI:()=>l.y,unbase64SVG:()=>l.I});var s=a(367),n=a(649),r=a(656),i=a(97),o=a(722),l=a(988)},527:(e,t,a)=>{a.r(t),a.d(t,{MIME_CLASS:()=>l,extensions:()=>d,default:()=>c,RenderedDiagram:()=>m});var s=a(706),n=a(656),r=a(97),i=a(649),o=a(745);const l="jp-DiagramMedia",d=n.WY.map((e=>{const{name:t}=e;return{id:`${r.NS}:rendermime-${t}`,name:t,rendererFactory:{safe:!0,mimeTypes:[e.mimetype],createRenderer:t=>(r.eM&&console.error("creating renderer"),new m(Object.assign(Object.assign({},t),{format:e})))},dataType:"string"}})),c=d;class m extends s.Panel{constructor(e){super(),this.initialized=!1,this.addClass(l),this.format=e.format,this.content=new i.S({adapter:{format:()=>this.format,urlParams:()=>{var e,t,a;let s={};const{manager:n}=m;null!=n&&(s=(null===(t=null===(e=n.settings)||void 0===e?void 0:e.composite)||void 0===t?void 0:t.drawioUrlParams)||{});const r=((null===(a=this.lastModel)||void 0===a?void 0:a.metadata)[this.format.mimetype]||{}).drawioUrlParams;return null!=r&&(s=Object.assign(Object.assign({},s),r)),s},drawioUrl:()=>o.DRAWIO_URL,saveNeedsExport:()=>{var e;return(null===(e=this.format)||void 0===e?void 0:e.isTransformed)||!0},drawioConfig:()=>{var e,t,a;let s={};const{manager:n}=m;null!=n&&(s=(null===(t=null===(e=n.settings)||void 0===e?void 0:e.composite)||void 0===t?void 0:t.drawioConfig)||{});const r=((null===(a=this.lastModel)||void 0===a?void 0:a.metadata)[this.format.mimetype]||{}).drawioConfig;return null!=r&&(s=Object.assign(Object.assign({},s),r)),s},toXML:()=>{var e;return null==this.lastModel?"":(null===(e=this.lastModel.data[this.format.mimetype])||void 0===e?void 0:e.toString())||""},fromXML:()=>{}}}),this.layout.addWidget(this.content)}onAfterShow(){this.initialized||(this.content.onAfterShow(),this.initialized=!0),this.content.onContentChanged()}async renderModel(e){const t=e.metadata||{},a=t?t[this.format.mimetype]:null;if(null!=a){const e=a.height?`${a.height}`:"";this.node.style.minHeight=e}this.lastModel=e,this.initialized?this.content.onContentChanged():this.isVisible?this.onAfterShow():setTimeout((()=>this.onAfterShow()),100)}}},883:(e,t,a)=>{a.r(t),a.d(t,{default:()=>R});var s=a(216),n=a(706),r=a(458),i=a(825),o=a(260),l=a(579),d=a(208),c=a(958),m=a(656),h=a(271),g=a.n(h);function u(e){var t;return(null===(t=e.status)||void 0===t?void 0:t.length)?g().createElement(s.TextItem,{onClick:e.handleClick,source:`drawio: ${e.status||"ready"}`,title:"TBDâ€¦"}):g().createElement("span",null)}class p extends i.VDomRenderer{constructor(e){super(e),this._popup=null,this.addClass(s.interactiveItem)}render(){return null==this.model?null:g().createElement(u,{handleClick:()=>this._handleClick(),status:this.model.status})}_handleClick(){const e=this._menu;this._popup&&this._popup.dispose(),e.aboutToClose.connect(this._menuClosed,this),this._popup=(0,s.showPopup)({body:e,anchor:this,align:"right"})}_menuClosed(){this.removeClass(s.clickedItem)}}!function(e){class t extends i.VDomModel{constructor(){super(...arguments),this._status=""}get status(){return this._status}set status(e){this._status!=e&&(this._status=e,this.stateChanged.emit(void 0))}}e.Model=t}(p||(p={}));var _=a(97),w=a(168),f=a(797),v=a(387),y=a(367),x=a(745);const M="jp-IPyDiagram-cards",C={label:"blank",url:"",thumbnail:"",tags:[]},E=["pages","layers"],b=["dark"],S=["light"];let T={kennedy:[...E,...S],dark:[...E,...b],sketch:[...E,...S,...b],min:[...E,...S,...b],atlas:[...E,...S]};class P extends i.VDomRenderer{constructor(e){super(e),this.onSearch=e=>{this.model.templateSearchText=e.currentTarget.value},this.renderFormat=(e,t)=>{const a=`ipydrawio-format-${e.name}`;let s=[];return e.isBinary&&s.push("binary"),e.isText&&s.push("text"),e.isJson&&s.push("json"),h.createElement("li",{key:e.name,"data-ipydrawio-format":e.ext},h.createElement("input",{type:"radio",name:"ipydrawio-format",id:a,onChange:()=>this.model.format=e,defaultChecked:!t}),h.createElement("label",{htmlFor:a},h.createElement("code",null,e.ext),h.createElement(e.icon.react,{width:100,tag:"span"}),this.renderTags(s)))},this.renderTheme=(e,t=-1)=>{const a=e||this.model.settingsUi,s=m.sc[a],n=`ipydrawio-theme-${t}`,r=[...T[a],...e?[]:["default"]];return h.createElement("li",{key:e,"data-ipydrawio-theme":e},h.createElement("input",{type:"radio",name:"ipydrawio-theme",id:n,onChange:()=>this.model.ui=e,defaultChecked:-1===t}),h.createElement("label",{htmlFor:n},`${a} ${e?"":"(default)"}`,h.createElement(s.react,{width:100,tag:"span"}),this.renderTags(r)))},this.renderTemplate=(e,t=-1)=>{const a=`ipydrawio-template-${t}`;return h.createElement("li",{key:e.url||"__blank__","data-ipydrawio-template":e.url},h.createElement("input",{type:"radio",name:"ipydrawio-template",id:a,value:e.url,onChange:()=>this.model.template=e,defaultChecked:-1===t}),h.createElement("label",{htmlFor:a},e.label,e.thumbnail?h.createElement("img",{src:e.thumbnail}):[],this.renderTags(e.tags||[])))},this.renderTag=e=>h.createElement("li",{key:e},e),this.title.icon=m.EH,this.title.label="New Diagram",this.addClass("jp-IPyDiagram-CreateCustom"),this.addClass("jp-RenderedHTMLCommon")}render(){var e;const t=m.sc[this.model.ui||this.model.settingsUi];let a=(null===(e=this.model.template)||void 0===e?void 0:e.label)||C.label;return a=`${a} ${this.model.format.ext}`,[h.createElement("header",{key:"header"},h.createElement("h1",null,"New Diagram"),h.createElement("label",null,this.model.cwd?h.createElement("pre",null,"/",this.model.cwd,"/"):""),h.createElement("input",{type:"text",className:"jp-mod-styled",defaultValue:this.model.name,placeholder:"untitled",onChange:e=>this.model.name=e.currentTarget.value}),h.createElement("label",null,h.createElement("pre",null,this.model.format.ext)),h.createElement("button",{onClick:this.model.requestDocument,type:"button",className:"jp-mod-styled jp-mod-accept"},h.createElement(t.react,{width:24,tag:"span"}),h.createElement("label",null,"NEW ",a.toLocaleUpperCase()))),h.createElement("form",{key:"form"},this.renderFormats(),this.renderThemes(),this.renderTemplates())]}renderFormats(){return h.createElement("section",null,h.createElement("h2",null,"Format"),h.createElement("ul",{className:M},this.model.formats.map(this.renderFormat)))}renderThemes(){return h.createElement("section",null,h.createElement("h2",null,"Theme"),h.createElement("ul",{className:M},this.renderTheme(null,-1),_.oP.map(this.renderTheme)))}renderTemplates(){return h.createElement("section",null,h.createElement("h2",null,"Template"," ",h.createElement("input",{type:"text",className:"jp-mod-styled",onChange:this.onSearch,title:"Search Templates",placeholder:"Search Templates"})),h.createElement("ul",{className:M},this.renderTemplate(C,-1),this.model.templates.map(this.renderTemplate)))}renderTags(e){return h.createElement("ul",{className:"jp-IPyDiagram-tags"},e.map(this.renderTag))}}!function(e){class t extends i.VDomModel{constructor(e){super(),this._templates=[],this._templateSearchText="",this._documentRequested=new w.Signal(this),this._format=m.Fl,this._name="",this._cwd=null,this.requestDocument=()=>{this._documentRequested.emit(void 0)},this._manager=e.manager,this._cwd=e.cwd||null,this._manager.templates().then((e=>{this._templates=e,this.stateChanged.emit(void 0)})).catch(console.warn)}get args(){return{name:this._name,format:this._format.key,drawioUrlParams:Object.assign(Object.assign({},this._ui?{ui:this._ui}:{}),this._template?{"template-filename":this._template.url}:{})}}get manager(){return this._manager}get cwd(){return this._cwd}set cwd(e){this._cwd=e,this.stateChanged.emit(void 0)}get name(){return this._name}set name(e){this._name=e,this.stateChanged.emit(void 0)}get templates(){const e=this._templateSearchText.trim().split(" ");if(!e.length)return this._templates;let t=[];for(const a of this._templates){let s=0;const n=`${a.label} ${(a.tags||[]).join(" ")}`;for(const t of e)-1!==n.indexOf(t)&&s++;s===e.length&&t.push(a)}return t}get formats(){const e=this._manager.formats.filter((e=>e.isEditable));return e.sort(((e,t)=>e.ext.length-t.ext.length)),e}get format(){return this._format}set format(e){this._format=e,this.stateChanged.emit(void 0)}get ui(){return this._ui}set ui(e){this._ui=e,this.stateChanged.emit(void 0)}get template(){return this._template}set template(e){this._template=e,this.stateChanged.emit(void 0)}set templateSearchText(e){this._templateSearchText=e,this.stateChanged.emit(void 0)}get templateSearchText(){return this._templateSearchText}get settingsUi(){const e=(this._manager.settings.composite||{}).drawioUrlParams||{};return e.ui?e.ui:"kennedy"}get documentRequested(){return this._documentRequested}}e.Model=t}(P||(P={}));const I=async(e,t,a=null)=>await e.exportAs(t);class F{constructor(e){this._formats=new Map,this._trackers=new Map,this._mimeExport=new Map,this._templates=new Map,this._templatesChanged=new w.Signal(this),this._formatsChanged=new w.Signal(this),this._app=e.app,this._restorer=e.restorer,this._palette=e.palette,this._browserFactory=e.browserFactory,this._status=new p.Model,this._initCommands(),this.initTemplates().catch(console.warn)}_initCommands(){const{commands:e}=this._app;e.addCommand(_.OF.createNew,{label:e=>{const{drawioUrlParams:t}=e,{ui:a}=t||{};return a?`${m.Fl.label} [${null==t?void 0:t.ui}]`:m.Fl.label},icon:e=>{const{drawioUrlParams:t}=e,{ui:a}=t||{};return a?m.sc[a]:m.EH},caption:`Create a blank ${m.Fl.ext} file`,execute:async e=>{let t=this._browserFactory.defaultBrowser.model.path;return await this.createNew(Object.assign(Object.assign({},e),{cwd:t}))}}),e.addCommand(_.OF.createNewCustom,{label:`Custom ${m.Fl.label}...`,caption:"Create a diagram with customized formats, templates, and UI",execute:()=>{const t=new P.Model({manager:this}),a=()=>t.stateChanged.emit(void 0),s=()=>t.cwd=n.model.path,{defaultBrowser:n}=this._browserFactory||{};this._settings.changed.connect(a),this._templatesChanged.connect(a),n&&(n.model.pathChanged.connect(s),s());const r=new P(t),o=new i.MainAreaWidget({content:r}),l=new f.PromiseDelegate,d=async()=>l.reject(void 0);return t.documentRequested.connect((async()=>{const r=await e.execute(_.OF.createNew,t.args);this._settings.changed.disconnect(a),this._templatesChanged.disconnect(a),n&&n.model.pathChanged.disconnect(s),o.disposed.disconnect(d),l.resolve(r),o.dispose(),t.dispose()})),o.disposed.connect(d),this._app.shell.add(o),l.promise},icon:m.EH})}get formats(){return[...this._formats.values()]}get formatsChanged(){return this._formatsChanged}formatForModel(e){_.eM&&console.warn("getting format",e);const{path:t}=e;let a="",s=null;for(const n of this._formats.values()){if(null!=n.wantsModel&&n.wantsModel(e))return n;t&&t.endsWith(n.ext)&&n.ext.length>a.length&&(s=n,a=n.ext)}return s||null}get drawioURL(){return x.DRAWIO_URL}get status(){return this._status}set status(e){this._status=e}get settings(){return this._settings}set settings(e){this._settings=e,this._settings.changed.connect(this._onSettingsChanged,this)}get activeWidget(){const{currentWidget:e}=this._app.shell;for(const t of this._trackers.values())if(t.currentWidget===e)return t.currentWidget;return null}async createNew(e){let{cwd:t}=e;const a=(e.format?this._formats.get(e.format):null)||m.Fl;this._status.status=`Creating Diagram in ${t}...`;let s=await this._app.commands.execute("docmanager:new-untitled",{path:t,type:a.contentType||"file",ext:a.ext});e.name&&e.name.trim()&&(s=await this._app.serviceManager.contents.rename(s.path,v.PathExt.join(v.PathExt.dirname(s.path),`${e.name.trim()}${a.ext}`))),this._status.status=`Opening Diagram ${s.path}...`;const n=await this._app.commands.execute("docmanager:open",{path:s.path,factory:a.factoryName});if(e.drawioUrlParams){n.urlParams=e.drawioUrlParams;const t=e.drawioUrlParams["template-filename"];if(t){await n.content.ready;const e=await fetch(t),a=await e.text();n.content.load(a)}}return n}_onSettingsChanged(){this._status.status="settings changed";for(const e of this._trackers.values())e.forEach(this.updateWidgetSettings)}get templatesChanged(){return this._templatesChanged}async templates(){return[...this._templates.values()]}addTemplates(...e){for(const t of e)this._templates.set(t.url,t);this._templatesChanged.emit(void 0)}async initTemplates(){const e=[],t=await fetch(v.URLExt.join(x.DRAWIO_URL,"../templates/index.xml")),a=await t.text(),s=(new DOMParser).parseFromString(a,"application/xml");for(const t of s.querySelectorAll("template")){let a=t.getAttribute("url");if(!a)continue;const[s,n]=a.replace(/.xml$/,"").replace(/_/g," ").split("/").slice(-2);a=v.URLExt.join(x.DRAWIO_URL,"../templates/",a),e.push({url:a,label:n,thumbnail:a.replace(/.xml$/,".png"),tags:[s,"builtin"]})}this.addTemplates(...e)}addFormat(e){if(_.eM&&console.warn(`adding format ${e.name}`,e),this._formats.has(e.key))throw Error(`cannot reregister ${e.key}`);this._formats.set(e.key,e),this._app.docRegistry.addFileType(Object.assign({name:e.name,contentType:e.contentType||"file",displayName:e.label,mimeTypes:[e.mimetype],extensions:[e.ext],icon:e.icon,fileFormat:e.format},e.pattern?{pattern:e.pattern}:{})),e.isExport&&(_.eM&&console.warn(`...export ${e.name}`),this._initExportCommands(e)),this._initTracker(e.modelName,e.factoryName,`drawio-${e.key}`,[e],e.isDefault?[e]:[]),_.eM&&console.warn(`...tracked ${e.name}`),this._formatsChanged.emit(void 0)}updateWidgetSettings(e){e.updateSettings()}escapeCurrent(e){if(this._settings.composite.disableEscapeFocus)return;this._app.shell.activateById(e.id);const{status:t}=this.status;this.status.status="Escaped",setTimeout((()=>this.status.status=t),1e3),window.focus()}_initExportCommands(e){const{ext:t,key:a,format:s,label:n,mimetype:r,icon:i}=e,o=e.save||String,l=async i=>{let l=this._app.shell.currentWidget,d=v.PathExt.basename(l.context.path).replace(/\.dio($|\.(svg|png|ipynb|pdf)$)/,"");this._status.status=`Exporting Diagram ${d} to ${n}...`;const c=await(e.exporter||I)(l.content,a,this._settings);if(null==c)return void(this._status.status=`Failed to export to ${n}... please retry`);this._status.status=`${d} ready, saving...`;let m=await this._app.commands.execute("docmanager:new-untitled",{path:i,type:e.contentType||"file",ext:t});const h=await this._getAvaialablePath(i,d,t);m=await this._app.serviceManager.contents.rename(m.path,h),null!=c&&await this._app.serviceManager.contents.save(m.path,Object.assign(Object.assign({},m),{format:s,mimetype:r,content:o(c)})),this._status.status=`${d} ${n} saved as ${v.PathExt.basename(h)}, launching...`;const g=this._app.docRegistry.preferredWidgetFactories(m.path).map((e=>e.name));g.length&&await this._app.commands.execute("docmanager:open",{factory:g[0],path:m.path}),this._status.status=`${v.PathExt.basename(h)} launched`};this._app.commands.addCommand(`drawio:export-${a}`,{label:e=>e.justLabel?n:`Export ${m.Fl.label} as ${n}`,icon:i,execute:()=>{let e=this._browserFactory.defaultBrowser.model.path;return l(e)},isEnabled:()=>null!=this.activeWidget}),this._palette.addItem({command:`drawio:export-${a}`,category:`${m.Fl.label} Export`})}async _getAvaialablePath(e,t,a,s=99){let n=`${t}ext`;const r={content:!1},{contents:i}=this._app.serviceManager;for(const o in[...Array(s).keys()]){const s=1==o.length?`0${o}`:`${o}`;n=v.PathExt.join(e,o?`${t}-${s}${a}`:`${t}ext`);try{const e=await i.get(n,r);console.warn("Path not available",e)}catch(e){return n}}throw new Error(`Couldn't find a writeable path for ${t}${a}`)}_initTracker(e,t,a,s,n){if(this._trackers.has(a))throw Error(t);const r=new y.m({modelName:e,name:t,fileTypes:s.map((({name:e})=>e)),defaultFor:n.map((({name:e})=>e)),getSettings:()=>this._settings.composite||{},manager:this}),o=new i.WidgetTracker({namespace:a});return this._restorer&&this._restorer.restore(o,{command:"docmanager:open",args:e=>({path:e.context.path,factory:t}),name:e=>e.context.path}).catch(console.warn),r.widgetCreated.connect(((e,t)=>{this._status.status="Loading Diagram...",t.content.frameClicked.connect((()=>{t!==this._app.shell.currentWidget&&t.node.focus()})),t.title.icon=m.EH,t.context.pathChanged.connect((()=>o.save(t))),t.content.frameClicked.connect((e=>{this._app.shell.activateById(t.id),this._status.status=`Editing ${t.context.path}`})),t.context.ready.then((()=>{var e;if(null==t.context.contentsModel)return void console.warn("widget not ready");const{mimetype:a}=t.context.contentsModel,s=null===(e=this._mimeExport.get(a))||void 0===e?void 0:e.icon;null!=s&&(t.title.icon=s),this._status.status=`${t.context.path} ready`})).catch(console.warn),o.add(t).catch(console.warn)})),this._app.docRegistry.addWidgetFactory(r),this._trackers.set(a,o),o}}var O=a(527),D=a(81);const N={id:`${_.NS}:widgets`,requires:[D.IJupyterWidgetRegistry,_.rY],autoStart:!0,activate:(e,t,s)=>{const n={name:_.NS,version:_.q4,exports:async()=>{const e=await Promise.resolve().then(a.bind(a,722));return e.DiagramView.diagrmManager=s,e}};_.eM&&console.warn("registering widgets",n),t.registerWidget(n)}};var A=a(568);const L={activate:function(e,t,a){const s=v.PageConfig.getOption("retroPage"),{commands:n}=e;if(A.DEBUG&&console.warn("retro page is",s),"tree"==s){const e=new i.CommandToolbarButton({commands:n,id:A.CommandIds.createNew});a.defaultBrowser.toolbar.insertItem(2,"new-diagram",e)}else"edit"===s&&e.shell.currentChanged.connect((async a=>{const{currentWidget:s}=e.shell;if(!s||s instanceof A.DiagramDocument)return;const n=s.context;if(!n)return;if(await n.ready,!n.contentsModel)return;const r=t.formatForModel(n.contentsModel);if(!r||!r.isDefault)return;const i=e.docRegistry.getWidgetFactory(r.factoryName);if(!i)return;const o=document.querySelector('link[rel="icon"], link.favicon');o.href=`data:image/svg+xml;utf8,${encodeURIComponent(r.icon.svgstr)}`,o.type="image/svg+xml",e.shell.addClass("jp-IPyDiagram-main"),s.dispose(),await e.commands.execute("docmanager:open",{path:n.path,factory:i.name,options:{ref:"_noref"}})}))},id:`${A.PLUGIN_ID}-retro`,requires:[_.rY],optional:[l.IFileBrowserFactory],autoStart:!0},R=[{activate:function(e,t,a,s,r,i,o,l){const{commands:d}=e,c=new F({app:e,restorer:i,palette:s,browserFactory:t});let h=null;l&&(h=new p(c.status),l.registerStatusItem(`${_.NS}:status`,{item:h,align:"right",rank:3,isActive:()=>null!=c.activeWidget})),r.load(_.Uu).then((e=>{_.eM&&console.warn("settings loaded",e.composite),c.settings=e})).catch((e=>console.error(e))),o&&(o.add({command:_.OF.createNew,rank:1,category:m.Fl.label}),o.add({command:_.OF.createNewCustom,rank:2,category:m.Fl.label})),d.addCommand(_.OF.setUrlParams,{label:e=>{const{drawioUrlParams:t}=e,a=Object.entries(t||{});if(1==a.length&&e.justValue)return a.map((([e,t])=>t)).join(", ");{const e=a.map((([e,t])=>`${e}: ${t}`.trim()),"");return`${m.Fl.label} `+e.join(", ")}},isToggleable:!0,isToggled:e=>{var t,a;const s=(null===(a=null===(t=c.settings)||void 0===t?void 0:t.composite)||void 0===a?void 0:a.drawioUrlParams)||{};for(const[t,a]of Object.entries(e.drawioUrlParams||{}))if(s.hasOwnProperty(t)&&s[t]!==a)return!1;return!0},execute:async e=>{var t,a;const s=(null===(a=null===(t=c.settings)||void 0===t?void 0:t.composite)||void 0===a?void 0:a.drawioUrlParams)||{};await c.settings.set("drawioUrlParams",Object.assign(Object.assign({},s),e.drawioUrlParams))}});for(const e of _.oP)s.addItem({command:_.OF.setUrlParams,args:{drawioUrlParams:{ui:e}},category:`${m.Fl.label} Settings`});if(a){const{fileMenu:e,settingsMenu:t}=a;a.fileMenu.newMenu.addGroup([{command:_.OF.createNew}],40);const s=new n.Menu({commands:d});s.title.label=`${m.Fl.label} Theme`;for(const e of _.oP)s.addItem({command:_.OF.setUrlParams,args:{drawioUrlParams:{ui:e},justValue:!0},type:"command"});const r=new n.Menu({commands:d});r.title.label=`Save and Export ${m.Fl.label} As...`;let i=[];c.formatsChanged.connect((()=>{for(const e of c.formats){const{key:t}=e;i.includes(t)||(i.push(t),r.addItem({command:`drawio:export-${t}`,args:{justValue:!0},type:"command"}))}})),t.addGroup([{submenu:s,type:"submenu"}],_.pj),e.addGroup([{submenu:r,type:"submenu"}],_.pj)}O.RenderedDiagram.manager=c;for(const e of m.t6)c.addFormat(e);return c},id:_.Uu,requires:[l.IFileBrowserFactory,c.IMainMenu,i.ICommandPalette,o.ISettingRegistry],optional:[r.ILayoutRestorer,d.ILauncher,s.IStatusBar],provides:_.rY,autoStart:!0},N,L]},722:(e,t,a)=>{a.r(t),a.d(t,{DiagramModel:()=>w,DiagramView:()=>f,XMLModel:()=>p,XMLView:()=>_});var s=a(361),n=a(797),r=a(81),i=a(390),o=a(745),l=a(649),d=a(97),c=a(62),m=a.n(c),h=a(317);m()(h.Z,{insert:"head",singleton:!1}),h.Z.locals;const g={gapi:0,gl:0,noExitBtn:1,noSaveBtn:1,od:0,stealth:1,tr:0,ui:"min",format:0,p:"ex;tips;svgdata;sql;anim;trees;replay;anon;flow;webcola;tags"},u={compressXml:!1,showStartScreen:!1,override:!0};class p extends r.WidgetModel{defaults(){return Object.assign(Object.assign({},super.defaults()),{_model_name:p.model_name,_model_module:d.NS,_model_module_version:d.q4,_view_name:p.view_name,_view_module:d.NS,_view_module_version:d.q4,value:'<mxfile version="13.3.6">\n<diagram id="x" name="Page-1">\n    <mxGraphModel dx="1450" dy="467" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="850" pageHeight="1100" math="0" shadow="0">\n    <root>\n        <mxCell id="0"/>\n        <mxCell id="1" parent="0"/>\n    </root>\n    </mxGraphModel>\n</diagram>\n</mxfile>\n'})}}p.model_name="XMLModel",p.model_module=d.NS,p.model_module_version=d.q4,p.view_name="XMLView",p.view_module=d.NS,p.view_module_version=d.q4;class _ extends r.WidgetView{}class w extends i.BoxModel{defaults(){return Object.assign(Object.assign({},super.defaults()),{_model_name:w.model_name,_model_module:d.NS,_model_module_version:d.q4,_view_name:w.view_name,_view_module:d.NS,_view_module_version:d.q4,scroll_x:0,scroll_y:0,zoom:1,page_ids:[],selected_page:0,selected_cells:[],grid_enabled:!0,grid_color:"#66666666",grid_size:10,url_params:g,config:u,page_format:{x:0,y:0,width:850,height:1100}})}initialize(e,t){super.initialize(e,t)}}w.model_name="DiagramModel",w.model_module=d.NS,w.model_module_version=d.q4,w.view_name="DiagramView",w.view_module=d.NS,w.view_module_version=d.q4,w.serializers=Object.assign(Object.assign({},i.BoxModel.serializers),{source:{deserialize:r.unpack_models}});class f extends i.BoxView{constructor(){super(...arguments),this.onModelZoom=()=>{const{view:e}=this.app.editor.graph,t=this.model.get("zoom");e.getScale()!==t&&e.setScale(t)},this.onModelScroll=()=>{const{view:e}=this.app.editor.graph,t=this.model.get("scroll_x"),a=this.model.get("scroll_y"),s=e.getTranslate();s.x===t&&s.y===a||e.setTranslate(t,a)},this.onModelPageFormat=()=>{const e=this.model.get("page_format"),t=this.app.editor.graph.pageFormat;n.JSONExt.deepEqual(e,t)||(d.eM&&console.warn("pageFormat",e),this.app.setPageFormat(Object.assign({},e)))},this.onModelPageSelected=()=>{this.app.selectPage(this.app.pages[this.model.get("current_page")])},this.onModelGridEnabled=()=>{this.app.editor.graph.setGridEnabled(this.model.get("grid_enabled")),this.app.editor.graph.refresh()},this.onModelGridSize=()=>{this.app.editor.graph.setGridSize(this.model.get("grid_size")),this.app.editor.graph.refresh()},this.onModelGridColor=()=>{this.app.setGridColor(this.model.get("grid_color"))},this.onModelSelectedCells=()=>{const e=this.model.get("selected_cells").reduce(((e,t)=>[...e,...this.app.editor.graph.getCellsById(t)]),[]);this.app.editor.graph.selectionModel.setCells(e)},this.onDrawioEvent=(e,t)=>{let a={};switch(t.name){case"change":a={selected_cells:this.app.editor.graph.selectionModel.cells.map((e=>e.getId()))};break;case"scale":case"scaleAndTranslate":a={zoom:this.app.editor.graph.view.getScale()};break;case"pan":case"translate":case"size":a=this.translateToScroll();break;case"pageSelected":a={current_page:this.app.pages.indexOf(this.app.currentPage),page_ids:this.app.pages.map((e=>e.getId()))};break;case"pageFormatChanged":a={page_format:this.app.editor.graph.pageFormat};break;case"gridEnabledChanged":a={grid_enabled:this.app.editor.graph.gridEnabled};break;case"gridSizeChanged":a={grid_size:this.app.editor.graph.gridSize};break;case"gridColorChanged":a={grid_color:this.app.editor.graph.view.gridColor};break;case"fireMouseEvent":break;default:d.eM&&console.warn("unhandled",t.name,t,"from",e)}const s={};for(const e of Object.keys(a))s[e]=this.model.attributes[e];n.JSONExt.deepEqual(s,a)||(this.model.set(a),this.touch())}}initialize(e){super.initialize(e)}render(){super.render(),this.pWidget.addClass("jp-IPyDiagram");const e=setInterval((()=>{this.pWidget.isVisible&&(clearInterval(e),this.initDiagram(),this.pWidget.addWidget(this.diagram),this.diagram.onContentChanged(),this.diagram.onAfterShow(),this.model.on("change:source",this.onModelSourceChange,this),this.onModelSourceChange())}),100)}onModelSourceChange(){const e=this.model.changed.source;null!=e&&e.off("change:value",this.onSourceValue,this);const t=this.model.get("source");null!=t&&t.on("change:value",this.onSourceValue,this)}onSourceValue(){d.eM&&console.warn("change:value"),this.diagram.onContentChanged()}initDiagram(){d.eM&&console.warn("creating diagram widget");const e=f.diagrmManager.formatForModel({path:"widget.dio"});this.diagram=new l.S({adapter:{saveNeedsExport:()=>!1,drawioUrl:()=>o.DRAWIO_URL,drawioConfig:()=>this.model.get("config"),urlParams:()=>this.model.get("url_params"),format:()=>e,toXML:()=>this.xml(),fromXML:e=>{(this.xml()||"").trim()!==(e||"").trim()&&this.xml(e)}}}),this.diagram.appChanged.connect(this.onAppChanged,this)}xml(e){const t=this.model.get("source");if(null==e)return null==t?void 0:t.get("value");null!=t&&(t.set({value:e}),t.save_changes(this.callbacks()))}onAppChanged(){const{app:e}=this.diagram;if(!e)return;d.eM&&console.warn("installing handlers on",e);const{editor:t}=e,{graph:a}=t,{view:n,model:r,panningHandler:i,selectionModel:o}=a,l=[{src:e,evts:d.GE},{src:t,evts:d.lq},{src:a,evts:d.wO},{src:n,evts:d.Bx},{src:r,evts:d.qp},{src:i,evts:d.Fy},{src:o,evts:d.up}];for(const{src:e,evts:t}of l)for(const a of t)e.addListener(a,this.onDrawioEvent);const c={limit:10};[{evt:"change:zoom",fn:this.onModelZoom},{evt:"change:scroll_x change:scroll_y",fn:this.onModelScroll},{evt:"change:page_format",fn:this.onModelPageFormat},{evt:"change:current_page",fn:this.onModelPageSelected},{evt:"change:grid_enabled",fn:this.onModelGridEnabled},{evt:"change:grid_size",fn:this.onModelGridSize},{evt:"change:grid_color",fn:this.onModelGridColor},{evt:"change:selected_cells",fn:this.onModelSelectedCells}].forEach((({evt:e,fn:t})=>{const a=new s.eD(t,c);this.model.on(e,(()=>a.invoke()),this)}))}get app(){return this.diagram.app}translateToScroll(){const{x:e,y:t}=this.app.editor.graph.view.getTranslate();return{scroll_x:e,scroll_y:t}}}}}]);